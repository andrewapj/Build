apply plugin: 'checkstyle'
apply plugin: "jacoco"
apply plugin: "java"

task fetchCheckStyleConfig(type:Download) {
    sourceUrl = 'https://raw.githubusercontent.com/andrewapj/Build/master/java/checkstyle/checkstyle.xml'
    target = new File('config/checkstyle/checkstyle.xml')
    ignoreErrors = true
}

test {
    dependsOn fetchCheckStyleConfig
    finalizedBy jacocoTestReport,jacocoTestCoverageVerification
    finalizedBy checkstyleMain,checkstyleTest
}

checkstyle{
    toolVersion = '8.9'
    maxWarnings = 0
    maxErrors = 0
    showViolations = true
}

jacocoTestCoverageVerification {
    violationRules {
        failOnViolation = false
        rule {
            limit {
                minimum = 0.80
            }
        }
    }
}

class Download extends DefaultTask {
    @Input
    String sourceUrl

    @OutputFile
    File target

    Boolean ignoreErrors = false

    @TaskAction
    void download() {
        ant.get(src: sourceUrl, dest: target, ignoreerrors: ignoreErrors)
    }
}
